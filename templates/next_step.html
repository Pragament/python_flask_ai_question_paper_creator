<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Next Step</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 min-h-screen py-10">
    <div class="max-w-5xl mx-auto bg-white p-8 rounded shadow">
      <h2 class="text-3xl font-bold text-center text-blue-700 mb-2">
        Prerequisite Topics
      </h2>
      <p class="text-center text-gray-600 mb-8">
        Select the prerequisites you'd like to include.
      </p>

      <form method="post" action="{{ url_for('generate_questions') }}">
        {% for class, subjects in selected_json.items() %}
        <div class="mb-8">
          <h3 class="text-2xl font-bold text-gray-800 mb-2">{{ class }}</h3>
          {% for subject, chapters in subjects.items() %}
          <div class="ml-4 mt-4">
            <h4 class="text-xl font-semibold text-blue-700">{{ subject }}</h4>

            {% for chapter in chapters %}
            <div class="mt-4 p-4 border rounded bg-gray-50">
              <label class="flex items-start gap-2">
                <input
                  type="checkbox"
                  name="selected_prereq_chapter"
                  value="{{ chapter.chapter }}"
                  class="mt-1 chapter-checkbox"
                />
                <div>
                  <p class="font-medium text-gray-900">
                    {{ chapter.chapter }} (Chapter {{ chapter.number }})
                  </p>
                  {% if chapter.reason %}
                  <p class="text-sm text-gray-600 italic mt-1">
                    <span class="font-semibold text-gray-700">Reason:</span>
                    {{ chapter.reason }}
                  </p>
                  {% endif %}
                </div>
              </label>

              {% if chapter.topics %}
              <div class="ml-6 mt-3 space-y-2">
                {% for topic in chapter.topics %}
                <div>
                  <label class="flex items-start gap-2">
                    <input
                      type="checkbox"
                      name="selected_prereq_topic"
                      value="{{ topic.topic }}"
                      class="mt-1 topic-checkbox"
                    />
                    <span class="font-semibold">{{ topic.topic }}</span>
                  </label>

                  {% if topic.subtopics %}
                  <div class="ml-6 mt-1 space-y-1">
                    {% for sub in topic.subtopics %}
                    <label class="flex items-start gap-2">
                      <input
                        type="checkbox"
                        name="selected_prereq_subtopic"
                        value="{{ sub.text }}"
                        class="mt-1 subtopic-checkbox"
                      />
                      <span>{{ sub.text }}</span>
                    </label>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
                {% endfor %}
              </div>
              {% else %}
              <p class="ml-6 text-sm text-gray-500">No topics listed.</p>
              {% endif %}
            </div>
            {% endfor %}
          </div>
          {% endfor %}
        </div>
        {% endfor %}

        <div class="flex justify-between mt-10">
          <a
            href="{{ url_for('download_pdf') }}"
            class="bg-gray-100 text-blue-600 border border-blue-600 hover:bg-blue-50 px-4 py-2 rounded text-sm font-medium"
          >
            Download Prereqs
          </a>
          <button
            type="submit"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm font-medium"
          >
            Generate Questions
          </button>
        </div>
      </form>
    </div>

    <script>
      document.querySelectorAll(".chapter-checkbox").forEach((chapterCheckbox) => {
        chapterCheckbox.addEventListener("change", () => {
          const container = chapterCheckbox.closest(".border");
          const inputs = container.querySelectorAll("input[type='checkbox']");
          inputs.forEach((box) => {
            if (box !== chapterCheckbox) box.checked = chapterCheckbox.checked;
          });
        });
      });

      document.querySelectorAll(".topic-checkbox").forEach((topicCheckbox) => {
        topicCheckbox.addEventListener("change", () => {
          const container = topicCheckbox.closest("div");
          const subs = container.querySelectorAll(".subtopic-checkbox");
          subs.forEach((s) => (s.checked = topicCheckbox.checked));
        });
      });
    </script>
  </body>
</html>